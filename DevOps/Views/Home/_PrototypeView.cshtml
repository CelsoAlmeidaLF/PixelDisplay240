<div id="prototype-view" class="view-panel">
    <!-- LEFT SIDEBAR -->
    <aside class="left-proto-sidebar">

        <!-- TFT COMMANDS TOOLBAR -->
        <div class="tool-group">
            <label class="tool-group-label">
                <span>Comandos TFT</span>
                <span class="tool-group-hint">clique para inserir</span>
            </label>

            <!-- FORMAS -->
            <div class="inspector-section-title">Formas</div>
            <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:8px;">
                <button class="tft-cmd-btn tool-btn" data-cmd="fillRect"      title="fillRect — Retângulo preenchido"><i data-lucide="square"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawRect"      title="drawRect — Contorno"><i data-lucide="square-dashed"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="fillRoundRect" title="fillRoundRect — Arredondado"><i data-lucide="square"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="fillCircle"    title="fillCircle — Círculo"><i data-lucide="circle"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawCircle"    title="drawCircle — Contorno círculo"><i data-lucide="circle-dashed"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="fillTriangle"  title="fillTriangle — Triângulo"><i data-lucide="triangle"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="fillEllipse"   title="fillEllipse — Elipse"><i data-lucide="ellipsis"></i></button>
            </div>

            <!-- LINHAS -->
            <div class="inspector-section-title">Linhas</div>
            <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:8px;">
                <button class="tft-cmd-btn tool-btn" data-cmd="drawLine"      title="drawLine — Linha diagonal"><i data-lucide="minus"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawFastHLine" title="drawFastHLine — Linha horizontal"><i data-lucide="move-horizontal"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawFastVLine" title="drawFastVLine — Linha vertical"><i data-lucide="move-vertical"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawPixel"     title="drawPixel — Pixel"><i data-lucide="dot"></i></button>
            </div>

            <!-- TEXTO -->
            <div class="inspector-section-title">Texto</div>
            <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:8px;">
                <button class="tft-cmd-btn tool-btn" data-cmd="drawString"       title="drawString — Texto simples"><i data-lucide="type"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="drawCentreString" title="drawCentreString — Texto centralizado"><i data-lucide="align-center"></i></button>
            </div>

            <!-- TELA -->
            <div class="inspector-section-title">Tela</div>
            <div class="grid" style="grid-template-columns:repeat(4,1fr);gap:4px;">
                <button class="tft-cmd-btn tool-btn" data-cmd="fillScreen" title="fillScreen — Fundo sólido"><i data-lucide="panel-top"></i></button>
                <button class="tft-cmd-btn tool-btn" data-cmd="pushImage"  title="pushImage — Imagem PROGMEM"><i data-lucide="image"></i></button>
            </div>
        </div>

        <!-- IMPORTAR IMAGEM (.jpg/.bmp) -->
        <div class="tool-group">
            <label>Importar Imagem</label>
            <button id="btn-upload-image" class="secondary-btn small-btn" style="width:100%;">
                <i data-lucide="image"></i> JPG / BMP / PNG
            </button>
            <input type="file" id="proto-image-upload" accept="image/jpeg,image/bmp,image/png,.bmp" style="display:none;">
        </div>


        <!-- EXPORTAR DESIGN -->
        <div class="tool-group">
             <label>Exportar</label>
             <button id="btn-import-design" class="tool-btn" title="Baixar Design (.h / .jpg)"
                     style="width:100%; background:linear-gradient(135deg,#4ade80,#22d3ee);color:#000;font-weight:700;display:flex;justify-content:center;gap:6px;">
                 <i data-lucide="download-cloud"></i> Baixar Design
             </button>
        </div>

        <!-- TELAS DO PROJETO -->
        <div class="tool-group">
            <label>Telas</label>
            <div id="screen-list" class="proto-screen-list"></div>
            
            <div style="display:flex; gap:4px; margin-top:8px; align-items:center;">
                <select id="screen-template-select" style="flex:1; height:28px; font-size:0.7rem; padding:0 6px; border-radius:6px; background:var(--bg-dark); color:var(--text-muted); border:1px solid var(--border);">
                    <option value="">Modelo: Vazio</option>
                    <option value="loading">Modelo: Loading</option>
                    <option value="menu">Modelo: Menu</option>
                    <option value="dashboard">Modelo: Dashboard</option>
                </select>
                <button id="btn-add-screen" class="secondary-btn small-btn" style="width:32px; height:28px; justify-content:center; padding:0;" title="Adicionar Tela">
                    <i data-lucide="plus"></i>
                </button>
            </div>
        </div>

        <div class="tool-group" style="flex:1;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
                <label style="margin:0;">Elementos na Tela</label>
                <div id="proto-sync-status" class="sync-badge synced"></div>
            </div>
            <div id="proto-element-list" class="layers-list" style="flex:1;overflow-y:auto;"></div>
        </div>

    </aside>


    <!-- CENTER: CODE EDITOR -->
    <section class="proto-code-area">
        <div class="proto-workspace-header">
            <div class="proto-workspace-title-group">
                <div class="status-badge badge-cpp">C++ CODE</div>
                <h2 class="proto-filename">pixelstream_v5.ino</h2>
            </div>
            <div class="workspace-actions" style="display:flex;gap:8px;">
                <button class="primary-btn small-btn" onclick="
                    const code = document.getElementById('proto-code-preview').value;
                    navigator.clipboard.writeText(code);
                    if(app?.toast) app.toast.show('success','Código Copiado','');">
                    <i data-lucide="copy"></i> Copiar
                </button>
            </div>
        </div>
        <div class="code-editor-main">
            <textarea id="proto-code-preview" spellcheck="false"></textarea>
        </div>
    </section>

    <!-- RIGHT SIDEBAR: DISPLAY PREVIEW + PROPERTIES -->
    <aside class="right-proto-sidebar">

        <!-- DISPLAY PREVIEW - sempre fixo no topo -->
        <div class="proto-workspace-box">
            <div class="inspector-label" style="padding:0.5rem;background:rgba(0,0,0,0.2);font-size:0.6rem;color:var(--primary);font-weight:800;display:flex;justify-content:space-between;">
                <span>DISPLAY 240×240</span>
                <span id="active-screen-title">Screen 1</span>
            </div>
            <div class="canvas-mount-small">
                <canvas id="proto-canvas" width="240" height="240"></canvas>
            </div>
        </div>

        <!-- PROPERTIES -->
        <div class="tool-group inspector-group" style="flex-shrink:0;">
            <label>Propriedades</label>
            <div id="proto-interaction-panel" class="inspector-details" style="max-height:220px;overflow-y:auto;"></div>
        </div>

        <!-- SCREEN THUMBNAILS -->
        <div class="proto-gallery-vertical">
            <label>Telas</label>
            <div id="proto-main-container" class="preview-vertical-list"></div>
        </div>

    </aside>
</div>
